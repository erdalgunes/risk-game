(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[369],{322:(e,r)=>{"use strict";function t(){if(void 0!==globalThis.crypto){let e=new Uint32Array(1);globalThis.crypto.getRandomValues(e);let r=6*Math.floor(715827882.5),t=e[0];for(;t>=r;)globalThis.crypto.getRandomValues(e),t=e[0];return t%6+1}return Math.floor(6*Math.random())+1}function o(e,r){if(e<2)throw Error("Attacker must have at least 2 troops (1 must remain)");if(r<1)throw Error("Defender must have at least 1 troop");let o=t(),i=t(),n=o>i,a=+!!n,s=r-a==0;return{success:s,attackerRoll:o,defenderRoll:i,attackerLoss:+!n,defenderLoss:a,conquered:s}}Object.defineProperty(r,"__esModule",{value:!0}),r.resolveCombat=o,r.simulateCompleteBattle=function(e,r){let t=e,i=r,n=0;for(;t>1&&i>0;){let e=o(t,i);if(t-=e.attackerLoss,i-=e.defenderLoss,++n>100)throw Error("Battle exceeded maximum rounds")}return{attackerRemaining:t,defenderRemaining:i,rounds:n}}},364:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createGame=function(e,r,t,i){let n={id:"player-red",color:"red",name:r,isAI:!1},a={id:"player-blue",color:"blue",name:t,isAI:"single-player"===i};return{id:e,players:[n,a],territories:(0,o.createInitialTerritories)(n.id,a.id),currentPlayerIndex:0,phase:"attack",winner:null,mode:i}},r.executeAttack=function(e,r,t){let o=(0,n.validateAttack)(e,r,t);if(!o.valid)return{updatedState:e,result:null,error:o.error};let a=e.territories.find(e=>e.id===r),s=e.territories.find(e=>e.id===t),l=(0,i.resolveCombat)(a.troops,s.troops),d=e.territories.map(e=>{if(e.id===r)return{...e,troops:e.troops-l.attackerLoss};if(e.id===t){let r=e.troops-l.defenderLoss;return 0===r?{...e,ownerId:a.ownerId,troops:1}:{...e,troops:r}}return e});if(l.conquered){let e=d.findIndex(e=>e.id===r);d[e]={...d[e],troops:d[e].troops-1}}let c={...e,territories:d},u=(0,n.checkWinner)(c);return u&&(c.winner=u),{updatedState:c,result:l}},r.executeFortify=function(e,r,t,o){let i=(0,n.validateFortify)(e,r,t,o);if(!i.valid)return{updatedState:e,error:i.error};let a=e.territories.map(e=>e.id===r?{...e,troops:e.troops-o}:e.id===t?{...e,troops:e.troops+o}:e);return{updatedState:{...e,territories:a}}},r.changePhase=function(e,r){return{...e,phase:r}},r.endTurn=function(e){return{...e,currentPlayerIndex:(e.currentPlayerIndex+1)%e.players.length,phase:"attack"}},r.getCurrentPlayer=function(e){return e.players[e.currentPlayerIndex]};let o=t(7532),i=t(322),n=t(4613)},1412:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.decideAIMove=function(e){let r=e.players[e.currentPlayerIndex],t=e.territories.filter(e=>e.ownerId===r.id);if("attack"===e.phase){let r=[];for(let i of t)if(!(i.troops<2))for(let t of i.adjacentTerritories)(0,o.validateAttack)(e,i.id,t).valid&&r.push({from:i.id,to:t});if(r.length>0&&.7>Math.random()){let e=r[Math.floor(Math.random()*r.length)];return{type:"attack",fromTerritoryId:e.from,toTerritoryId:e.to}}return{type:"end-turn"}}if("fortify"===e.phase){let r=[];for(let i of t)if(!(i.troops<2))for(let n of t){if(i.id===n.id)continue;let t=Math.floor(i.troops/2);!(t<1)&&(0,o.validateFortify)(e,i.id,n.id,t).valid&&r.push({from:i.id,to:n.id,troops:t})}if(r.length>0&&.4>Math.random()){let e=r[Math.floor(Math.random()*r.length)];return{type:"fortify",fromTerritoryId:e.from,toTerritoryId:e.to,troops:e.troops}}}return{type:"end-turn"}},r.shouldAITakeTurn=function(e){return!e.winner&&e.players[e.currentPlayerIndex].isAI};let o=t(4613)},2590:(e,r,t)=>{"use strict";var o=Object.create?function(e,r,t,o){void 0===o&&(o=t);var i=Object.getOwnPropertyDescriptor(r,t);(!i||("get"in i?!r.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return r[t]}}),Object.defineProperty(e,o,i)}:function(e,r,t,o){void 0===o&&(o=t),e[o]=r[t]},i=function(e,r){for(var t in e)"default"===t||Object.prototype.hasOwnProperty.call(r,t)||o(r,e,t)};Object.defineProperty(r,"__esModule",{value:!0}),i(t(6511),r),i(t(7532),r),i(t(322),r),i(t(4613),r),i(t(364),r),i(t(1412),r)},3094:(e,r,t)=>{"use strict";t.d(r,{default:()=>d});var o=t(4568),i=t(7620),n=t(2590);function a(e){let{gameState:r,selectedTerritory:t,onTerritoryClick:i}=e,n=e=>({1:{x:0,y:0},2:{x:200,y:0},3:{x:400,y:0},4:{x:0,y:140},5:{x:200,y:140},6:{x:400,y:140}})[e];return(0,o.jsxs)("div",{className:"bg-gray-800 rounded-lg p-8 mb-6",children:[(0,o.jsxs)("svg",{viewBox:"0 0 ".concat(600," ").concat(280),className:"w-full max-w-4xl mx-auto",style:{maxHeight:"500px"},children:[[["1","2"],["2","3"],["1","4"],["2","5"],["3","6"],["4","5"],["5","6"]].map((e,r)=>{let[t,i]=e,a=n(t),s=n(i),l=a.x+90,d=a.y+60,c=s.x+90,u=s.y+60;return(0,o.jsx)("line",{x1:l,y1:d,x2:c,y2:u,stroke:"#4b5563",strokeWidth:"2",strokeDasharray:"5,5"},"connection-".concat(r))}),r.territories.map(e=>{var a;let s=n(e.id),l=(e=>{let t=r.players.find(r=>r.id===e);return(null==t?void 0:t.color)==="red"?"#dc2626":"#2563eb"})(e.ownerId),d=t===e.id?"#fbbf24":"#374151",c=t===e.id;return(0,o.jsxs)("g",{onClick:()=>i(e.id),className:"cursor-pointer transition-transform hover:scale-105",style:{transformOrigin:"".concat(s.x+90,"px ").concat(s.y+60,"px")},children:[(0,o.jsx)("rect",{x:s.x,y:s.y,width:180,height:120,fill:l,stroke:d,strokeWidth:c?"4":"2",rx:"8",opacity:"0.9"}),(0,o.jsx)("text",{x:s.x+90,y:s.y+40,textAnchor:"middle",fill:"white",fontSize:"18",fontWeight:"bold",children:e.name}),(0,o.jsx)("text",{x:s.x+90,y:s.y+80,textAnchor:"middle",fill:"white",fontSize:"32",fontWeight:"bold",children:e.troops}),(0,o.jsx)("text",{x:s.x+90,y:s.y+100,textAnchor:"middle",fill:"white",fontSize:"12",opacity:"0.7",children:null==(a=r.players.find(r=>r.id===e.ownerId))?void 0:a.name})]},e.id)})]}),(0,o.jsxs)("div",{className:"flex justify-center gap-8 mt-6",children:[(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[(0,o.jsx)("div",{className:"w-4 h-4 bg-red-600 rounded"}),(0,o.jsx)("span",{className:"text-sm",children:r.players[0].name})]}),(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[(0,o.jsx)("div",{className:"w-4 h-4 bg-blue-600 rounded"}),(0,o.jsx)("span",{className:"text-sm",children:r.players[1].name})]}),t&&(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[(0,o.jsx)("div",{className:"w-4 h-4 bg-yellow-500 rounded"}),(0,o.jsx)("span",{className:"text-sm",children:"Selected"})]})]})]})}function s(e){let{gameState:r,currentPlayer:t,onEndTurn:i}=e;if(r.winner){let e=r.players.find(e=>e.id===r.winner);return(0,o.jsxs)("div",{className:"bg-green-900 border-4 border-green-500 rounded-lg p-8 text-center",children:[(0,o.jsx)("h2",{className:"text-3xl font-bold mb-2",children:"\uD83C\uDF89 Victory!"}),(0,o.jsxs)("p",{className:"text-xl",children:[null==e?void 0:e.name," has conquered all territories!"]}),(0,o.jsx)("button",{onClick:()=>window.location.href="/",className:"mt-4 px-6 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg",children:"Play Again"})]})}let n="red"===t.color?"bg-red-600":"bg-blue-600",a="attack"===r.phase?"⚔️ Attack Phase":"\uD83D\uDE9A Fortify Phase";return(0,o.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6",children:[(0,o.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,o.jsxs)("div",{children:[(0,o.jsxs)("h3",{className:"text-xl font-bold",children:["Current Player: ",(0,o.jsx)("span",{className:"".concat(n," px-3 py-1 rounded"),children:t.name})]}),(0,o.jsx)("p",{className:"text-gray-400 mt-1",children:a})]}),(0,o.jsx)("button",{onClick:i,disabled:t.isAI,className:"px-6 py-3 bg-orange-600 hover:bg-orange-700 disabled:bg-gray-600 disabled:cursor-not-allowed rounded-lg font-medium",children:"attack"===r.phase?"Skip to Fortify":"End Turn"})]}),(0,o.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,o.jsxs)("div",{className:"bg-gray-700 rounded p-3",children:[(0,o.jsx)("p",{className:"text-gray-400 mb-1",children:"Instructions:"}),"attack"===r.phase?(0,o.jsx)("p",{children:"Select your territory, then click an adjacent enemy territory to attack"}):(0,o.jsx)("p",{children:"Select your territory, then click another of your territories to move troops"})]}),(0,o.jsxs)("div",{className:"bg-gray-700 rounded p-3",children:[(0,o.jsx)("p",{className:"text-gray-400 mb-1",children:"Game Mode:"}),(0,o.jsx)("p",{children:"single-player"===r.mode?"\uD83E\uDD16 vs AI":"\uD83D\uDC65 Multiplayer"})]})]})]})}var l=t(5110);function d(e){let{gameId:r,mode:t,playerName:d}=e,[c,u]=(0,i.useState)(null),[f,p]=(0,i.useState)(null),[y,m]=(0,i.useState)(""),[h,x]=(0,i.useState)("multiplayer"===t);(0,i.useEffect)(()=>{let e=(0,n.createGame)(r,d,"single-player"===t?"AI":"Player 2",t);if(u(e),"multiplayer"===t)try{(0,l.getSupabaseClient)().from("game_states").insert({id:r,state:JSON.stringify(e)}).then(e=>{e.error?(console.error("Error saving game:",e.error),m("⚠️ Multiplayer mode requires Supabase setup"),x(!1)):console.log("Game saved to Supabase")})}catch(e){console.error("Error initializing Supabase:",e),m("⚠️ Multiplayer mode requires Supabase setup"),x(!1)}},[r,d,t]),(0,i.useEffect)(()=>{if(!h||!c)return;let e=(0,l.getSupabaseClient)(),t=e.channel("game:".concat(r)).on("postgres_changes",{event:"UPDATE",schema:"public",table:"game_states",filter:"id=eq.".concat(r)},e=>{u(JSON.parse(e.new.state)),m("Game updated"),setTimeout(()=>m(""),2e3)}).subscribe();return()=>{e.removeChannel(t)}},[r,h,c]),(0,i.useEffect)(()=>{if(!c||h||!(0,n.shouldAITakeTurn)(c))return;let e=setTimeout(()=>{g((0,n.decideAIMove)(c))},1e3);return()=>clearTimeout(e)},[c,h]);let g=(0,i.useCallback)(e=>{if(c)if("attack"===e.type&&e.fromTerritoryId&&e.toTerritoryId){let{updatedState:r,result:t,error:o}=(0,n.executeAttack)(c,e.fromTerritoryId,e.toTerritoryId);!o&&t&&(u(r),m("AI attacks: ".concat(t.attackerRoll," vs ").concat(t.defenderRoll," - ").concat(t.conquered?"Conquered!":"Defended")))}else if("fortify"===e.type&&e.fromTerritoryId&&e.toTerritoryId&&e.troops){let{updatedState:r,error:t}=(0,n.executeFortify)(c,e.fromTerritoryId,e.toTerritoryId,e.troops);t||(u(r),m("AI fortifies: moved ".concat(e.troops," troops")))}else"attack"===c.phase?u((0,n.changePhase)(c,"fortify")):(u((0,n.endTurn)(c)),m("AI ended turn"))},[c]),v=(0,i.useCallback)(async e=>{if(u(e),h){let t=(0,l.getSupabaseClient)().from("game_states");await t.update({state:JSON.stringify(e)}).eq("id",r)}},[r,h]),b=(0,i.useCallback)(e=>{if(!c||c.winner)return;let r=(0,n.getCurrentPlayer)(c);if(r.isAI)return;let t=c.territories.find(r=>r.id===e);if(t){if(!f){t.ownerId===r.id&&(p(e),m("Selected ".concat(t.name)));return}if(f===e){p(null),m("");return}if("attack"===c.phase){let{updatedState:r,result:t,error:o}=(0,n.executeAttack)(c,f,e);o?m("❌ ".concat(o)):t&&(v(r),m("⚔️ Attack: ".concat(t.attackerRoll," vs ").concat(t.defenderRoll," - ").concat(t.conquered?"Conquered!":"Defended")),p(null))}else if("fortify"===c.phase){let r=c.territories.find(e=>e.id===f);if(r){let t=Math.floor(r.troops/2),{updatedState:o,error:i}=(0,n.executeFortify)(c,f,e,t);i?m("❌ ".concat(i)):(v(o),m("✅ Moved ".concat(t," troops")),p(null))}}}},[c,f,v]),j=(0,i.useCallback)(()=>{c&&("attack"===c.phase?(v((0,n.changePhase)(c,"fortify")),m("Fortify phase - move troops or end turn")):(v((0,n.endTurn)(c)),m("Turn ended"),p(null)))},[c,v]);if(!c)return(0,o.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,o.jsx)("p",{className:"text-xl",children:"Loading game..."})});let A=(0,n.getCurrentPlayer)(c);return(0,o.jsx)("div",{className:"min-h-screen p-8",children:(0,o.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,o.jsxs)("div",{className:"mb-6 text-center",children:[(0,o.jsxs)("h1",{className:"text-3xl font-bold mb-2",children:["Risk PoC - ","single-player"===t?"vs AI":"Multiplayer"]}),y&&(0,o.jsx)("p",{className:"text-yellow-400",children:y})]}),(0,o.jsx)(a,{gameState:c,selectedTerritory:f,onTerritoryClick:b}),(0,o.jsx)(s,{gameState:c,currentPlayer:A,onEndTurn:j})]})})}},4609:(e,r,t)=>{"use strict";var o=t(7011);Object.defineProperty(r,"__esModule",{value:!0}),r.getSupabaseClient=function(){if(n)return n;let e=o.env.NEXT_PUBLIC_SUPABASE_URL,r=o.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;if(!e||!r)throw Error("Missing Supabase environment variables");return n=(0,i.createClient)(e,r,{realtime:{params:{eventsPerSecond:10}}})},r.resetClient=function(){n=null};let i=t(8800),n=null},4613:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.validateAttack=function(e,r,t){let i=e.players[e.currentPlayerIndex],n=e.territories.find(e=>e.id===r),a=e.territories.find(e=>e.id===t);return n&&a?n.ownerId!==i.id?{valid:!1,error:"You do not own the attacking territory"}:a.ownerId===i.id?{valid:!1,error:"Cannot attack your own territory"}:n.troops<2?{valid:!1,error:"Need at least 2 troops to attack"}:(0,o.areTerritoriesAdjacent)(r,t)?{valid:!0}:{valid:!1,error:"Territories are not adjacent"}:{valid:!1,error:"Territory not found"}},r.validateFortify=function(e,r,t,o){let i=e.players[e.currentPlayerIndex],n=e.territories.find(e=>e.id===r),a=e.territories.find(e=>e.id===t);return n&&a?n.ownerId!==i.id?{valid:!1,error:"You do not own the source territory"}:a.ownerId!==i.id?{valid:!1,error:"You do not own the destination territory"}:n.troops<=o?{valid:!1,error:"Must leave at least 1 troop behind"}:o<1?{valid:!1,error:"Must move at least 1 troop"}:!function(e,r,t,o){if(r===t)return!0;let i=new Set,n=[r];for(i.add(r);n.length>0;){let r=n.shift();if(r===t)return!0;let a=e.territories.find(e=>e.id===r);if(a){for(let r of a.adjacentTerritories)if(!i.has(r)){let t=e.territories.find(e=>e.id===r);t&&t.ownerId===o&&(i.add(r),n.push(r))}}}return!1}(e,r,t,i.id)?{valid:!1,error:"Territories are not connected through your territories"}:{valid:!0}:{valid:!1,error:"Territory not found"}},r.checkWinner=function(e){let r=new Map;for(let t of e.territories){let e=r.get(t.ownerId)||0;r.set(t.ownerId,e+1)}for(let[e,t]of r.entries())if(6===t)return e;return null};let o=t(7532)},4903:(e,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0})},5110:(e,r,t)=>{"use strict";var o=Object.create?function(e,r,t,o){void 0===o&&(o=t);var i=Object.getOwnPropertyDescriptor(r,t);(!i||("get"in i?!r.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return r[t]}}),Object.defineProperty(e,o,i)}:function(e,r,t,o){void 0===o&&(o=t),e[o]=r[t]},i=function(e,r){for(var t in e)"default"===t||Object.prototype.hasOwnProperty.call(r,t)||o(r,e,t)};Object.defineProperty(r,"__esModule",{value:!0}),i(t(4903),r),i(t(4609),r)},6511:(e,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0})},7532:(e,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ADJACENCY_MAP=r.TERRITORY_NAMES=void 0,r.createInitialTerritories=function(e,t){return[{id:"1",name:r.TERRITORY_NAMES["1"],ownerId:e,troops:3,adjacentTerritories:r.ADJACENCY_MAP["1"]},{id:"2",name:r.TERRITORY_NAMES["2"],ownerId:e,troops:3,adjacentTerritories:r.ADJACENCY_MAP["2"]},{id:"3",name:r.TERRITORY_NAMES["3"],ownerId:e,troops:3,adjacentTerritories:r.ADJACENCY_MAP["3"]},{id:"4",name:r.TERRITORY_NAMES["4"],ownerId:t,troops:3,adjacentTerritories:r.ADJACENCY_MAP["4"]},{id:"5",name:r.TERRITORY_NAMES["5"],ownerId:t,troops:3,adjacentTerritories:r.ADJACENCY_MAP["5"]},{id:"6",name:r.TERRITORY_NAMES["6"],ownerId:t,troops:3,adjacentTerritories:r.ADJACENCY_MAP["6"]}]},r.areTerritoriesAdjacent=function(e,t){return r.ADJACENCY_MAP[e].includes(t)},r.TERRITORY_NAMES={1:"Territory 1",2:"Territory 2",3:"Territory 3",4:"Territory 4",5:"Territory 5",6:"Territory 6"},r.ADJACENCY_MAP={1:["2","4"],2:["1","3","5"],3:["2","6"],4:["1","5"],5:["2","4","6"],6:["3","5"]}},8623:(e,r,t)=>{Promise.resolve().then(t.bind(t,3094))}},e=>{e.O(0,[800,587,18,358],()=>e(e.s=8623)),_N_E=e.O()}]);